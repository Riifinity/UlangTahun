<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Selamat Ulang Tahun</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Comic Sans MS',cursive;
  background:url('https://files.catbox.moe/71ct8n.jpg') center/cover fixed no-repeat;
  min-height:100vh;display:flex;flex-direction:column;align-items:center;
  overflow:hidden;text-align:center;
}
body::before{content:'';position:fixed;inset:0;z-index:-1;
  backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
#preloadScreen{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px;background:#000;color:#fff;z-index:20000;font-family:'Poppins',sans-serif;font-size:28px}

#introScreen{position:fixed;inset:0;display:none;flex-direction:column;justify-content:center;align-items:center;gap:18px;padding:0 24px;background:rgba(0,0,0,.35);transition:opacity .8s;z-index:999}
.introSmall,.introBig{white-space:pre}
.introSmall{font:700 48px 'Poppins',sans-serif;color:#fff;text-shadow:2px 2px 6px #000a}
.introBig  {font:700 92px 'Brush Script MT',cursive;color:#ffdb4d;text-shadow:2px 2px 8px #000d}
.hidden{visibility:hidden}
#introBtn{margin-top:110px;font:700 34px sans-serif;padding:22px 70px;border-radius:40px;border:none;background:rgba(128,128,128,.6);color:#fff;cursor:pointer;box-shadow:0 6px 12px #0004;opacity:0;transform:translateY(120%);pointer-events:none;transition:background .3s}
#introBtn:hover{background:rgba(90,90,90,.8)}
@keyframes btnUp{from{transform:translateY(120%);opacity:0}to{transform:translateY(0);opacity:1}}
.btn-up{animation:btnUp .8s forwards ease-out}
.introLine span{display:inline-block;opacity:0}
@keyframes fromTop{from{transform:translateY(-120%);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes fromBottom{from{transform:translateY(120%);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes fromLeft{from{transform:translateX(-120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes fromRight{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
.top-char{animation:fromTop .6s forwards ease-out}
.bottom-char{animation:fromBottom .6s forwards ease-out}
.left-char{animation:fromLeft .6s forwards ease-out}
.right-char{animation:fromRight .6s forwards ease-out}
.fade-out{opacity:0}

#mainPage{display:none;width:100%}
h1{margin:80px 0 60px;font-size:64px;font-weight:bold;color:#fff;overflow:hidden;white-space:nowrap}
h1 span{display:inline-block;opacity:0}
@keyframes slideLeft{from{transform:translateX(-120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideRight{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
.from-left{animation:slideLeft .6s forwards}
.from-right{animation:slideRight .6s forwards}

.banner{display:flex;justify-content:center;gap:40px;margin-bottom:100px;flex-wrap:wrap;padding:0 20px}
.banner img{width:180px;height:240px;object-fit:cover;border-radius:20px;opacity:0;transform:rotate(var(--rot));box-shadow:4px 6px 12px #0004;border:8px solid rgba(128,128,128,.25)}
.foto1{--rot:-10deg}.foto2{--rot:-7deg}.foto3{--rot:7deg}.foto4{--rot:10deg}
@keyframes bannerFromTop{0%{opacity:0;transform:rotate(var(--rot)) translateY(-160px) scale(.9)}90%{opacity:1;transform:rotate(var(--rot)) translateY(8px) scale(1.04)}100%{opacity:1;transform:rotate(var(--rot)) translateY(0) scale(1)}}
@keyframes bannerFromBottom{0%{opacity:0;transform:rotate(var(--rot)) translateY(160px) scale(.9)}90%{opacity:1;transform:rotate(var(--rot)) translateY(-8px) scale(1.04)}100%{opacity:1;transform:rotate(var(--rot)) translateY(0) scale(1)}}
.banner-top-in{animation:bannerFromTop 1.4s cubic-bezier(.22,.61,.36,1) forwards}
.banner-bottom-in{animation:bannerFromBottom 1.4s cubic-bezier(.22,.61,.36,1) forwards}

.slider-container{margin-top:80px;display:flex;flex-direction:column;align-items:center;gap:30px}
.slider{width:460px;height:640px;position:relative}
.slider img{position:absolute;inset:0;width:460px;height:640px;border-radius:40px;object-fit:cover;opacity:0;z-index:0;transition:opacity .4s;border:28px solid rgba(128,128,128,.25)}
.slider img.active{opacity:1;z-index:60}
@keyframes slideInRight{from{transform:translateX(150%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideInLeft{from{transform:translateX(-150%);opacity:0}to{transform:translateX(0);opacity:1}}
.slide-right{animation:slideInRight .8s forwards ease-out}
.slide-left{animation:slideInLeft .8s forwards ease-out}

.nav-buttons{display:flex;gap:60px}
.nav-button{width:65px;height:65px;border:none;border-radius:50%;background:rgba(128,128,128,.6);color:#fff;font-size:34px;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 10px #0003;cursor:pointer;opacity:0;pointer-events:none;transition:background .3s,transform .2s}
.nav-button:hover{background:rgba(90,90,90,.8);transform:scale(1.1)}
.arrow-left::before{content:"◀"} .arrow-right::before{content:"▶"}
@keyframes navFromLeft{from{transform:translateX(-150%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes navFromRight{from{transform:translateX(150%);opacity:0}to{transform:translateX(0);opacity:1}}
.nav-show-left{animation:navFromLeft .8s forwards ease-out}
.nav-show-right{animation:navFromRight .8s forwards ease-out}
.btn-common{padding:14px 40px;font:700 24px sans-serif;background:rgba(128,128,128,.6);color:#fff;border:none;border-radius:30px;box-shadow:0 6px 12px #0003;transition:background .3s;opacity:0;transform:translateY(150%);pointer-events:none}
.btn-common:hover{background:rgba(90,90,90,.8)}
#btnNext{margin:60px 0 80px}
@keyframes btnUpMain{from{transform:translateY(150%);opacity:0}to{transform:translateY(0);opacity:1}}
.show-btn{animation:btnUpMain .7s forwards ease-out}

#finalOverlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;justify-content:center;align-items:center;padding:40px;opacity:0;visibility:hidden;transition:opacity .8s;z-index:2000}
#finalOverlay.show{visibility:visible;opacity:1}
#finalBox{display:flex;flex-direction:column;align-items:flex-start;width:100%}
#finalText{font-family:'Quicksand',sans-serif;font-size:24px;line-height:1.8;color:#fff;white-space:pre-wrap;text-align:left;text-shadow:2px 2px 6px #000d}
#btnContinue{align-self:center;margin-top:40px}

#photoCurtain{position:fixed;inset:0;display:none;background:#FFF7E6;overflow-y:auto;z-index:3000}
.gridCurtain{display:grid;grid-template-columns:repeat(auto-fill, minmax(81px, 1fr));gap:2px;padding:2px}
.gridCurtain img{width:81px;height:180px;object-fit:cover;opacity:0;filter:blur(3px);transition:filter .6s linear,opacity .6s linear}
@keyframes curtainDrop{0%{opacity:0;transform:translateY(-30px) scale(.92)}100%{opacity:1;transform:translateY(0) scale(1)}}

#seqStage{position:fixed;inset:0;display:none;justify-content:center;align-items:center;z-index:4000;pointer-events:none}
#seqStage img{width:70vmin;max-width:90%;height:auto;border-radius:40px;overflow:hidden;box-shadow:0 6px 14px #0004;opacity:0;filter:blur(10px);transition:opacity .6s ease,filter .6s ease}

#curtainTextTop,#curtainTextBottom{
  position:fixed;left:50%;transform:translateX(-50%);
  font-family:'Poppins',sans-serif;font-size:44px;font-weight:bold;color:#fff;
  text-shadow:2px 2px 8px #000d;opacity:0;pointer-events:none;z-index:5001;transition:opacity .8s ease-out;
}
#curtainTextTop{top:10vh}#curtainTextBottom{bottom:10vh}
#curtainTextTop.show,#curtainTextBottom.show{opacity:1}

#endingOverlay{
  position:fixed;inset:0;background:#000;opacity:0;visibility:hidden;
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  z-index:6000;transition:opacity 2.5s ease-in-out;
}
#endingOverlay.show{visibility:visible;opacity:1}
#endingTitle,#endingSubtitle{
  font-family:'Arial',sans-serif!important;font-weight:bold;color:#fff;
  text-shadow:2px 2px 10px #000;white-space:pre;text-align:center;margin-bottom:20px;
}
#endingSubtitle span{font-size:40px;display:inline-block;opacity:0}
@keyframes slideInLeft{from{transform:translateX(-100%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.slide-from-left{animation:slideInLeft .8s forwards ease-out}
.slide-from-right{animation:slideInRight .8s forwards ease-out}
</style>
</head>
<body>

<div id="preloadScreen"><p id="loadText">Memuat foto: 0%</p></div>

<section id="introScreen">
  <div id="line1" class="introSmall introLine">Selamat Ulang Tahun</div>
  <div id="line2" class="introBig   introLine">Raudatul Zahra</div>
  <div id="line3" class="introSmall introLine hidden">Maaf Cuman Bisa Ngasih Ini</div>
  <button id="introBtn">Mulai</button>
</section>

<section id="mainPage">
  <h1 id="titleText">Selamat Ulang Tahun Cantikk</h1>

  <div class="banner">
    <img class="foto1" src="https://files.catbox.moe/6dfbzn.jpg" alt="Foto 1">
    <img class="foto2" src="https://files.catbox.moe/k7gyay.jpg" alt="Foto 2">
    <img class="foto3" src="https://files.catbox.moe/rlqtdr.jpg" alt="Foto 3">
    <img class="foto4" src="https://files.catbox.moe/yv331i.jpg" alt="Foto 4">
  </div>

  <div class="slider-container">
    <div class="slider" id="slider">
      <img src="https://files.catbox.moe/uuryse.jpg">
      <img src="https://files.catbox.moe/35ljz6.jpg">
      <img src="https://files.catbox.moe/2e7692.jpg">
      <img src="https://files.catbox.moe/z8y77y.jpg">
      <img src="https://files.catbox.moe/1l2sl6.jpg">
    </div>

    <div class="nav-buttons">
      <button id="btnLeft"  class="nav-button arrow-left"></button>
      <button id="btnRight" class="nav-button arrow-right"></button>
    </div>
  </div>

  <button id="btnNext" class="btn-common">Lanjutkan</button>
</section>

<div id="finalOverlay">
  <div id="finalBox">
    <div id="finalText"></div>
    <button id="btnContinue" class="btn-common">Lanjutkan</button>
  </div>
</div>

<div id="photoCurtain"></div>
<div id="seqStage"><img id="seqImg" src=""></div>

<div id="endingOverlay">
  <h1 id="endingTitle"></h1>
  <p id="endingSubtitle"></p>
</div>

<script>
/* ------------------------- AUDIO ------------------------- */
const audioMulai   = new Audio('https://files.catbox.moe/ma5g5q.mp3');
const audioLanjut2 = new Audio('https://files.catbox.moe/u294ui.mp4');
const audioLanjut3 = new Audio('https://files.catbox.moe/75ooy9.mp3');
function playAudio(a){a.pause();a.currentTime=0;a.play()}

/* -------------------- TEXT WRAPPER ----------------------- */
function wrap(el,mode){
  const txt=el.textContent.trim();el.textContent='';
  [...txt].forEach((c,i)=>{
    const s=document.createElement('span');
    s.textContent=c===' ' ? '\u00A0' : c;
    s.className=mode==='tb'?(i%2?'bottom-char':'top-char'):(i%2?'right-char':'left-char');
    s.style.animationDelay=`${i*0.1}s`;
    el.appendChild(s);
  });
  return (txt.length-1)*100+600;
}

/* -------------------- IMAGE SOURCES ---------------------- */
const CURTAIN_SOURCES=[
  "https://files.catbox.moe/7jegej.jpg","https://files.catbox.moe/rdbnzs.jpg","https://files.catbox.moe/jveg9f.jpg","https://files.catbox.moe/ie9naw.jpg",
  "https://files.catbox.moe/12c83t.jpg","https://files.catbox.moe/neuiv6.jpg","https://files.catbox.moe/cid2uy.jpg","https://files.catbox.moe/9joued.jpg",
  "https://files.catbox.moe/jp24eq.jpg","https://files.catbox.moe/69d8yw.jpg","https://files.catbox.moe/7511cg.jpg","https://files.catbox.moe/j6kml7.jpg",
  "https://files.catbox.moe/56p7tb.jpg","https://files.catbox.moe/qgo2za.jpg","https://files.catbox.moe/t3rgae.jpg","https://files.catbox.moe/31f1bz.jpg",
  "https://files.catbox.moe/wivbo0.jpg","https://files.catbox.moe/477pif.jpg","https://files.catbox.moe/a6pwgc.jpg","https://files.catbox.moe/630x8m.jpg",
  "https://files.catbox.moe/7pxuup.jpg","https://files.catbox.moe/lnun3w.jpg","https://files.catbox.moe/6i95u6.jpg","https://files.catbox.moe/t3rgae.jpg",
  "https://files.catbox.moe/22qcs2.jpg","https://files.catbox.moe/aqk802.jpg","https://files.catbox.moe/04l2bp.jpg","https://files.catbox.moe/3gg5un.jpg",
  "https://files.catbox.moe/b1sxoa.jpg","https://files.catbox.moe/ctwjk2.jpg","https://files.catbox.moe/sbnja0.jpg","https://files.catbox.moe/4jm9uj.jpg",
  "https://files.catbox.moe/v5izj7.jpg","https://files.catbox.moe/62mpax.jpg","https://files.catbox.moe/j7eqkv.jpg","https://files.catbox.moe/2e8gvu.jpg",
  "https://files.catbox.moe/l80b00.jpg","https://files.catbox.moe/jg6btc.jpg","https://files.catbox.moe/fae5z1.jpg","https://files.catbox.moe/9zrzti.jpg",
  "https://files.catbox.moe/07pjvn.jpg","https://files.catbox.moe/rdbnzs.jpg","https://files.catbox.moe/6dfbzn.jpg","https://files.catbox.moe/p72m4b.jpg",
  "https://files.catbox.moe/1l2sl6.jpg","https://files.catbox.moe/44l72s.jpg","https://files.catbox.moe/3wi3r7.jpg","https://files.catbox.moe/yamfzu.jpg",
  "https://files.catbox.moe/qqmrba.jpg","https://files.catbox.moe/k7gyay.jpg","https://files.catbox.moe/rlqtdr.jpg","https://files.catbox.moe/35ljz6.jpg",
  "https://files.catbox.moe/yv331i.jpg","https://files.catbox.moe/uuryse.jpg","https://files.catbox.moe/2e7692.jpg","https://files.catbox.moe/dxnqfd.jpg",
  "https://files.catbox.moe/xovd2v.jpg","https://files.catbox.moe/ieyz0b.jpg","https://files.catbox.moe/p74v40.jpg","https://files.catbox.moe/4an3ay.jpg"
];
const SEQ_SOURCES=CURTAIN_SOURCES.slice(0,55); // 55 foto besar

const EXTRA_SOURCES=[
  'https://files.catbox.moe/6dfbzn.jpg','https://files.catbox.moe/k7gyay.jpg','https://files.catbox.moe/rlqtdr.jpg','https://files.catbox.moe/yv331i.jpg',
  'https://files.catbox.moe/uuryse.jpg','https://files.catbox.moe/35ljz6.jpg','https://files.catbox.moe/2e7692.jpg','https://files.catbox.moe/z8y77y.jpg',
  'https://files.catbox.moe/1l2sl6.jpg'
];
const PRELOAD_LIST=[...CURTAIN_SOURCES,...EXTRA_SOURCES];

/* ------------------ PRELOAD ------------------------------- */
function preloadImages(list,cb){
  let loaded=0,total=list.length;
  list.forEach(src=>{
    const img=new Image();
    img.onload=img.onerror=()=>{
      loaded++;
      document.getElementById('loadText').textContent=`Memuat foto: ${Math.round(loaded/total*100)}%`;
      if(loaded===total)cb();
    };
    img.src=src;
  });
}

function preloadAudio(list, cb){
  let loaded = 0;
  const total = list.length;

  function updateProgress() {
    document.getElementById('loadText').textContent = `Memuat audio: ${Math.round(loaded / total * 100)}%`;
    if (loaded === total) cb();
  }

  list.forEach(audio => {
    audio.oncanplaythrough = () => {
      loaded++;
      updateProgress();
    };
    audio.onerror = () => {
      loaded++;
      updateProgress();
    };
    audio.load();
  });
}


/* ------------------ INTRO & MAIN -------------------------- */
function initIntro(){
  const btn=document.getElementById('introBtn');
  const d1=wrap(document.getElementById('line1'),'tb');
  setTimeout(()=>{
    const d2=wrap(document.getElementById('line2'),'lr');
    setTimeout(()=>{
      document.getElementById('line3').classList.remove('hidden');
      const d3=wrap(document.getElementById('line3'),'tb');
      setTimeout(()=>{btn.classList.add('btn-up');btn.style.pointerEvents='auto'},d3);
    },d2);
  },0);
  btn.onclick=()=>{
    playAudio(audioMulai);
    document.getElementById('introScreen').classList.add('fade-out');
    setTimeout(()=>{document.getElementById('introScreen').style.display='none';showMain()},800);
  };
}

const TITLE="Selamat Ulang Tahun Cantikk";
const bannerImgs=[...document.querySelectorAll('.banner img')];
const slides=[...document.querySelectorAll('#slider img')];
const btnL=document.getElementById('btnLeft');
const btnR=document.getElementById('btnRight');
const btnNext=document.getElementById('btnNext');
let current=0,z=100;

function resetMain(){
  const title=document.getElementById('titleText');
  title.textContent=TITLE;title.className='';
  bannerImgs.forEach(i=>{i.style.opacity=0;i.classList.remove('banner-top-in','banner-bottom-in')});
  slides.forEach(i=>{i.style.opacity=0;i.classList.remove('active','slide-left','slide-right');i.style.zIndex=''});
  btnL.classList.remove('nav-show-left');btnR.classList.remove('nav-show-right');
  btnL.style.opacity=btnR.style.opacity=0;btnL.style.pointerEvents=btnR.style.pointerEvents='none';
  btnNext.classList.remove('show-btn');btnNext.style.opacity=0;btnNext.style.transform='translateY(150%)';btnNext.style.pointerEvents='none';
}

function showMain(){
  document.getElementById('mainPage').style.display='block';
  resetMain();
  const title=document.getElementById('titleText');
  title.textContent='';
  [...TITLE].forEach((c,i)=>{
    const s=document.createElement('span');
    s.textContent=c===' ' ? '\u00A0':c;
    s.className=i%2?'from-right':'from-left';
    s.style.animationDelay=`${i*0.1}s`;
    title.appendChild(s);
  });
  const titleDur=((TITLE.length-1)*0.1+0.6)*1000;
  const BDELAY=1.2;
  setTimeout(()=>{
    bannerImgs.forEach((img,i)=>{
      img.classList.add(i%2===0?'banner-top-in':'banner-bottom-in');
      img.style.animationDelay=`${i*BDELAY}s`;
    });
  },titleDur);
  const bannerTotal=((bannerImgs.length-1)*BDELAY+1.4)*1000;
  setTimeout(()=>{
    [4,3,2,1,0].forEach((idx,st)=>setTimeout(()=>{
      slides[idx].classList.add(st%2?'slide-left':'slide-right');
      slides[idx].style.opacity=1;
      slides[idx].style.zIndex=++z;
    },st*800));
    setTimeout(()=>activateNav(),5*800+800);
  },titleDur+bannerTotal+400);
}

function activateNav(){
  btnL.classList.add('nav-show-left');btnR.classList.add('nav-show-right');
  btnL.style.opacity=btnR.style.opacity='1';
  btnL.style.pointerEvents=btnR.style.pointerEvents='auto';
  const setSlide=i=>{
    slides.forEach((img,idx)=>{
      img.classList.toggle('active',idx===i);
      img.style.zIndex=idx===i?++z:idx;
    });
    current=i;
  };
  setSlide(0);
  btnR.onclick=()=>setSlide((current+1)%slides.length);
  btnL.onclick=()=>setSlide((current-1+slides.length)%slides.length);
  setTimeout(()=>{
    btnNext.classList.add('show-btn');
    btnNext.style.pointerEvents='auto';
    btnNext.onclick=showFinal;
  },700);
}

/* -------------- FINAL MESSAGE (TYPE EFFECT) -------------- */
const pesan=`selamat ulang tahun cantikk
widii udaaa 18 tahunn, dah tuaaaaa iiiii
maap yaa cuman bisa bikinkan inii
tapii semoga sukaa yaaa
makasii yaa masii mauu temenann
walaupun aku banyakk bangetttttt salahh
maafff bangett yaa karna aku banyak salahhh
makasii jugaa udaa mau dengerin cerita ku, sama keluh kesahkuu
makasiii udaa selaluu support akuu
makasii jugaa udaa sering ngapresiasi akuu 
walau padahal yang ku dapat ga terlalu berguna
tapii aku sukaa di apresiasiii, walaupun itu hal kecill
jadii makasii bangett yaaa
tetap temenan yaa? aku tauu kita gabisa balikk lagii
makanyaa aku minta kita tetap temenan ajaa
soalnya aku emang sadarr kita gabisaa balik lagii
jadii tetap temenan yaaa?
yayayaya?
dan jangann sampaii jadi kaya orang ga kenal yaa...
eee anuu....
ituu makai foto yang ada di flashdisk hhehe
masih belum aku hapus foto nyaa
nanti pan kapan insyaallah aku hapus yaa
buat sekarang ndaa dulu hhehe
oh yaa semoga di umur yang ke 18 tahun inii makin kuatt yaa
makin baikk, makin cantiii ( dari dulu sebenernya udah cantik sii )
sama semoga menjadi pribadi yang lebih baik yaa
semoga apa yang di inginkan di wujudkan, aaamiinnn...
semangat terus yaa cantikk
kalo ada apa apa cerita yaaa, akuu selalu terbukaa disinii
karna mau gimanapun kamu punya ruang tersendiriii disinii
mau sebanyak apapun orang yang datangg
tetepp kamu punya ruang tersendiri disinii
mau gimanaaa pun kamu pemenangnya disiniii
sekali lagi matt ulang tahun cantikk
i love youu more 🫶🏻`;

const overlay=document.getElementById('finalOverlay');
const box=document.getElementById('finalText');
function typeEffect(text,done){
  let i=0;
  const t=setInterval(()=>{
    box.textContent+=text[i];
    i++;
    if(i===text.length){clearInterval(t);done()}
  },35);
}
function showFinal(){
  document.getElementById('mainPage').classList.add('fade-out');
  audioMulai.pause();audioMulai.currentTime=0;
  audioLanjut2.pause();audioLanjut2.currentTime=0;
  audioLanjut2.play();
  setTimeout(()=>{
    document.getElementById('mainPage').style.display='none';
    overlay.classList.add('show');
    typeEffect(pesan,()=>{
      setTimeout(()=>{
        btnContinue.classList.add('show-btn');
        btnContinue.style.pointerEvents='auto';
      },1000);
    });
  },800);
}

const btnContinue=document.getElementById('btnContinue');
btnContinue.onclick=()=>{
  btnContinue.style.pointerEvents='none';
  overlay.classList.remove('show');
  box.textContent='';
  btnContinue.classList.remove('show-btn');
  audioLanjut2.pause();audioLanjut2.currentTime=0;
  playAudio(audioLanjut3);
  startCurtain();
};

/* -------------- CURTAIN & SEQUENCE ----------------------- */
const curtain=document.getElementById('photoCurtain');
const seqStage=document.getElementById('seqStage');
const seqImg=document.getElementById('seqImg');

let scrollRAF=null;
function startInfinityScroll(el,speed){
  let last=null;
  function step(ts){
    if(last!==null){
      el.scrollTop+=speed*(ts-last);
      if(el.scrollTop>=el.scrollHeight-el.clientHeight)el.scrollTop=0;
    }
    last=ts;
    scrollRAF=requestAnimationFrame(step);
  }
  scrollRAF=requestAnimationFrame(step);
}
function stopInfinityScroll(){
  if(scrollRAF!==null){cancelAnimationFrame(scrollRAF);scrollRAF=null}
}

/* ---- Parameters ---- */
const TOTAL_SMALL=220;
const SEQ_TRIGGER=77;
const delayStep=0.25;   // detik
const dropDur=0.55;     // detik anim curtainDrop
const DUR_BIG=800;      // ms antar foto besar

function startCurtain(){
  curtain.innerHTML='<div class="gridCurtain"></div>';
  const grid=curtain.firstElementChild;
  curtain.scrollTop=0;
  curtain.style.display='block';

  /* Tambahkan 220 gambar kecil dengan animasi bertahap */
  for(let i=0;i<TOTAL_SMALL;i++){
    const img=document.createElement('img');
    img.src=CURTAIN_SOURCES[i%CURTAIN_SOURCES.length];
    img.style.animation=`curtainDrop ${dropDur}s ease-out forwards`;
    img.style.animationDelay=`${i*delayStep}s`;
    grid.appendChild(img);
  }

  /* Waktu visual munculnya foto kecil ke-120 */
  const sequenceDelayMs=Math.round((SEQ_TRIGGER)*delayStep*1000 + dropDur*1000);

  /* Jalankan infinite-scroll + foto besar tepat saat 120 kecil telah muncul */
  setTimeout(()=>{
    startInfinityScroll(curtain,0.02);   // ~20 px/detik
    startSequence();
  },sequenceDelayMs);
}

/* -------------- BIG PHOTO SEQUENCE ----------------------- */
function startSequence(){
  /* Animated overlay texts */
  const makeAnimated=(id,text)=>{
    let el=document.getElementById(id);
    if(!el){el=document.createElement('div');el.id=id;document.body.appendChild(el)}
    el.innerHTML='';
    [...text].forEach((c,i)=>{
      const s=document.createElement('span');
      s.textContent=c===' ' ? '\u00A0':c;
      s.className=i%2?'right-char':'left-char';
      s.style.animationDelay=`${i*0.1}s`;
      el.appendChild(s);
    });
    el.classList.add('show');
  };
  makeAnimated('curtainTextTop','Selamat Ulang Tahun Cantikk');
  makeAnimated('curtainTextBottom','I love you more');

  /* Stage foto besar */
  seqStage.style.display='flex';
  let idx=0;
  function show(i){
    seqImg.style.opacity=0;seqImg.style.filter='blur(10px)';
    setTimeout(()=>{
      seqImg.src=SEQ_SOURCES[i];
      seqImg.onload=()=>{void seqImg.offsetWidth;seqImg.style.opacity=1;seqImg.style.filter='blur(0)'}
    },100);
  }
  show(idx);
  const timer=setInterval(()=>{
    idx++;
    if(idx>=SEQ_SOURCES.length){
      clearInterval(timer);
      concludeCurtain();          // selesai setelah 55 foto besar
    }else{
      show(idx);
    }
  },DUR_BIG);
}

/* -------------- END & PENUTUP ---------------------------- */
function concludeCurtain(){
  /* Biarkan animasi kecil & scroll tetap berjalan sampai overlay tampil */
  showEndingOverlay();
}

function showEndingOverlay(){
  const overlay=document.getElementById('endingOverlay');
  const title=document.getElementById('endingTitle');
  const subtitle=document.getElementById('endingSubtitle');
  const t1="Terimakasih Udah Mau Buka";
  const t2="I Loveeee Youuu Moreee 🤍";
  title.innerHTML='';subtitle.innerHTML='';
  [...t1].forEach((c,i)=>{
    const span=document.createElement('span');
    span.textContent=c===' ' ? '\u00A0':c;
    span.className=i%2?'slide-from-right':'slide-from-left';
    span.style.animationDelay=`${i*0.1}s`;
    title.appendChild(span);
  });
  [...t2].forEach((c,i)=>{
    const span=document.createElement('span');
    span.textContent=c===' ' ? '\u00A0':c;
    span.className=i%2?'slide-from-right':'slide-from-left';
    span.style.animationDelay=`${i*0.1}s`;
    subtitle.appendChild(span);
  });
  overlay.classList.add('show');

  /* Hentikan scroll & sembunyikan curtain beberapa detik setelah overlay muncul */
  setTimeout(()=>{
    stopInfinityScroll();
    curtain.style.display='none';
  },2000);
}

/* -------------- DOMContentLoaded ------------------------ */
document.addEventListener('DOMContentLoaded', () => {
  preloadImages(PRELOAD_LIST, () => {
    document.getElementById('loadText').textContent = 'Memuat audio: 0%';
    preloadAudio([audioMulai, audioLanjut2, audioLanjut3], () => {
      document.getElementById('preloadScreen').style.display = 'none';
      document.getElementById('introScreen').style.display = 'flex';
      initIntro();
    });
  });
});

</script>

</body>
</html>
